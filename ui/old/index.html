<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <title>Amaru PI</title>
  <style>
    header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; height: 20vh;}
    header a { text-decoration: none; }
    header nav ul { list-style: none; display: flex; gap: 1rem; margin: 0; padding: 0; }
    header nav ul li a { cursor: pointer; text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0; }
    header nav ul li a.active { border-bottom: 2px solid var(--pico-primary); }
    header nav ul li a[aria-disabled=true] { color: gray; }
    main { display: flex; height: 80vh; padding: 0 0 1rem; margin: 0 3rem; }
    iframe#content-frame { flex: 1; border: none; display: block; }
  </style>
</head>
<body>

  <header>
    <a href="#"><h2>Amaru PI</h2></a>
    <nav aria-label="Main navigation">
        <ul />
    </nav>
  </header>

  <main>
    <iframe id="content-frame"></iframe>
  </main>

  <script>
    function loadLinkedPage(link, page) {
        // Do nothing if link is already active
        if (link.classList.contains('active')) {
          return;
        }

        loadPage(page);

        // Update active link
        link.classList.add('active');
    }

    function loadPage(page) {
      const iframe = document.getElementById('content-frame');
      const url = `${page}?_=${Date.now()}`; // Cache buster, make sure page is always loaded fresh
      iframe.src = url;
      iframe.addEventListener('load', () => {
        iframe.contentDocument.body.style.margin = '0';
      });

      // Clear active state from all links
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    }

    function loadErrorPage() { loadPage('error.html') }

    function loadPageFromLocationHashOrDefault() {
        // Read page=XXX from location.hash
        const hashValues = location.hash.slice(1).split('&').map(pair => pair.split('='));
        const hashPage = hashValues.find(([key, _]) => key === 'page')?.[1];
        if (hashPage) {
            const page = Object.values(pages).find(p => p.page === `${hashPage}.html`);
            const link = [...document.querySelectorAll('nav a')].find(a => a.dataset.page === `${hashPage}.html`);
            if (link && !page.disabled) {
                loadLinkedPage(link, link.dataset.page);
            } else {
                loadErrorPage();
            }
        } else {
            loadPage('main.html')
        }
    }

    const pages = {
      'Main': {page: 'main.html', hidden: true},
      'Quick start': {page: 'quick-start.html', disabled: false},
      'Build': {page: 'build.html', disabled: false},
      'App': {page: 'app.html', hidden: true},
      'Claim': {page: 'claim.html'},
    };

    document.addEventListener('DOMContentLoaded', () => {
        const navList = document.querySelector('header nav ul');
        navList.innerHTML = '';

        // Append li elements to the header from `pages`
        Object.entries(pages).filter(([_, value]) => !value.hidden).forEach(([title, value]) => {
            const li = document.createElement('li');
            const a = document.createElement('a');

            a.textContent = title;
            a.href = '#';
            a.dataset.page = value.page;
            a.ariaDisabled = value.disabled ? 'true' : 'false';
            a.onclick = (e) => {
                e.preventDefault();
                if (!value.disabled) {
                  history.pushState(null, '', `#page=${value.page.replace('.html', '')}`);
                  loadLinkedPage(a, value.page);
                }
            };

            li.appendChild(a);
            navList.appendChild(li);
        });

        loadPageFromLocationHashOrDefault();
    });

    window.addEventListener('hashchange', loadPageFromLocationHashOrDefault);
  </script>

</body>
</html>